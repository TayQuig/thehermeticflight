---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Image } from 'astro:assets';

// 1. Generate static paths for all blog posts
export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'blog'>;

// 2. Get the current post data
const post = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.pubDate.toLocaleDateString('en-us', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout docTitle={`${post.data.title} | The Hermetic Flight Blog`}>
    <!-- An extra layer of dark gradient at the top to ensure header readability -->
    <div class="absolute top-0 left-0 w-full h-96 bg-gradient-to-b from-black/80 to-transparent z-0 pointer-events-none"></div>

	<main class="relative z-10 pt-32 pb-20 px-6 sm:px-8">
		<article class="max-w-3xl mx-auto">
            <!-- Header Area -->
            <header class="mb-12 text-center">
                 <div class="flex items-center justify-center gap-x-4 text-sm text-indigo-300 mb-4">
                    <time datetime={post.data.pubDate.toISOString()}>{formattedDate}</time>
                    <span>•</span>
                    <span>{post.data.author}</span>
                </div>
                <h1 class="text-3xl md:text-5xl font-bold text-white mb-8 leading-tight">{post.data.title}</h1>

                <!-- Hero Image -->
                {post.data.heroImage && (
                    <div class="rounded-xl overflow-hidden shadow-2xl shadow-indigo-900/20 mb-10 aspect-video relative">
                        <Image 
                            src={post.data.heroImage} 
                            alt={post.data.heroImageAlt || ""}
                            class="object-cover w-full h-full"
                            width={1024}
                            height={576}
                            loading="eager"
                        />
                    </div>
                )}
            </header>
            
            <!-- 
               The MDX Content Rendered Here. 
               We use 'prose-invert' for dark mode markdown styling.
               We override some specifics to match the site vibe.
            -->
			<div class="prose prose-lg prose-invert max-w-none 
                prose-headings:text-amber-100 
                prose-a:text-amber-200 prose-a:no-underline hover:prose-a:underline
                prose-strong:text-white prose-strong:font-semibold
                prose-img:rounded-xl prose-img:shadow-lg
            ">
				<Content />
			</div>
            
            <!-- Tags/Footer area of the post -->
            {post.data.tags && (
                <footer class="mt-12 pt-6 border-t border-white/10">
                    <div class="flex gap-3 flex-wrap">
                        {post.data.tags.map(tag => (
                             <span class="text-sm text-indigo-300 bg-indigo-950/50 px-3 py-1 rounded-full">#{tag}</span>
                        ))}
                    </div>
                    <div class="mt-8">
                        <a href="/blog" class="text-indigo-300 hover:text-amber-200 transition flex items-center gap-2">
                            ← Back to Flight Log
                        </a>
                    </div>
                </footer>
            )}
		</article>
	</main>
</Layout>